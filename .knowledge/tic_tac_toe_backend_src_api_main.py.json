{"is_source_file": true, "format": "Python", "description": "This is a Python source file implementing a REST API backend for an online Tic Tac Toe game with score tracking. It uses FastAPI framework with endpoints for user registration, authentication, game initiation, move submission, game state retrieval, move history, and leaderboard. It manages a SQLite database with tables for users, games, and moves, and includes game logic helpers and security features.", "external_files": ["fastapi", "fastapi.security", "pydantic", "typing", "sqlite3", "passlib.context", "jose", "datetime"], "external_methods": ["FastAPI", "HTTPException", "Depends", "status", "OAuth2PasswordBearer", "OAuth2PasswordRequestForm", "CORSMiddleware", "BaseModel", "Field", "sqlite3.connect", "CryptContext", "jwt.encode", "jwt.decode", "jwt.encode", "jwt.decode"], "published": ["health_check", "register", "login", "start_game", "submit_move", "get_board_state", "get_moves", "get_my_games", "get_leaderboard", "me", "app"], "classes": [{"name": "Token", "description": "Represents JWT token with access token string and token type."}, {"name": "UserRegister", "description": "Model for user registration payload containing username and password."}, {"name": "UserPublic", "description": "Publicly accessible user info including id, username, and score."}, {"name": "MoveRequest", "description": "Model for move submission containing board position."}, {"name": "GameCreateRequest", "description": "Payload for starting a new game with opponent username."}, {"name": "GamePublic", "description": "Public representation of a game including players, board state, status, and timestamps."}, {"name": "MovePublic", "description": "Representation of a move including player, position, symbol, and timestamp."}, {"name": "LeaderboardEntry", "description": "Leaderboard entry with username and score."}], "methods": [{"name": "verify_password(plain_password, hashed_password)", "description": "Verifies a plain password against a hashed password using bcrypt.", "scope": "", "scopeKind": ""}, {"name": "get_password_hash(password)", "description": "Generates a bcrypt hash for a given password.", "scope": "", "scopeKind": ""}, {"name": "create_access_token(data: dict, expires_delta: Optional[timedelta] = None)", "description": "Creates a JWT access token with expiration.", "scope": "", "scopeKind": ""}, {"name": "get_user_by_username(db_conn, username: str)", "description": "Fetches a user row from the database by username.", "scope": "", "scopeKind": ""}, {"name": "get_user_by_id(db_conn, user_id: int)", "description": "Fetches a user row by ID from the database.", "scope": "", "scopeKind": ""}, {"name": "get_current_user(token: str = Depends(oauth2_scheme))", "description": "Dependency that decodes JWT and retrieves current user info.", "scope": "", "scopeKind": ""}, {"name": "parse_board(board: str)", "description": "Converts string-based board into a 3x3 matrix.", "scope": "", "scopeKind": ""}, {"name": "stringify_board(matrix)", "description": "Converts a 3x3 matrix board into a string.", "scope": "", "scopeKind": ""}, {"name": "get_game_status(board: str)", "description": "Determines game status ('X', 'O', 'draw', 'ongoing') based on board.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Simple endpoint to check backend health.", "scope": "", "scopeKind": ""}, {"name": "register(user: UserRegister)", "description": "Endpoint to register a new user with username and password.", "scope": "", "scopeKind": ""}, {"name": "login(form_data: OAuth2PasswordRequestForm = Depends())", "description": "Endpoint to authenticate and get JWT token.", "scope": "", "scopeKind": ""}, {"name": "start_game(req: GameCreateRequest, current_user=Depends(get_current_user))", "description": "Creates a new game against specified opponent.", "scope": "", "scopeKind": ""}, {"name": "submit_move(game_id: int, move: MoveRequest, current_user=Depends(get_current_user))", "description": "Submits a move for the current user in specified game, updates game state.", "scope": "", "scopeKind": ""}, {"name": "get_board_state(game_id: int, current_user=Depends(get_current_user))", "description": "Retrieves current state of a specific game.", "scope": "", "scopeKind": ""}, {"name": "get_moves(game_id: int, current_user=Depends(get_current_user))", "description": "Fetches all moves played in a game chronologically.", "scope": "", "scopeKind": ""}, {"name": "get_my_games(current_user=Depends(get_current_user))", "description": "Lists all games involving the current user.", "scope": "", "scopeKind": ""}, {"name": "get_leaderboard()", "description": "Returns top users by score.", "scope": "", "scopeKind": ""}, {"name": "me(current_user=Depends(get_current_user))", "description": "Fetches current user's public info.", "scope": "", "scopeKind": ""}, {"name": "get_db()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "init_db()", "scope": "", "scopeKind": "", "description": "unavailable"}], "search-terms": ["FastAPI", "Tic Tac Toe", "auth", "JWT", "game management", "score tracking", "SQLite", "multiplayer", "move submission", "leaderboard"], "state": 2, "file_id": 4, "knowledge_revision": 11, "git_revision": "5a3e6300f16e60cefa1bf8d0b5a46dc9b7446844", "revision_history": [{"9": "96b91902f49ba54744a352fd96b12cc6c2ea82d5"}, {"10": "5a3e6300f16e60cefa1bf8d0b5a46dc9b7446844"}, {"11": "5a3e6300f16e60cefa1bf8d0b5a46dc9b7446844"}], "ctags": [{"_type": "tag", "name": "ACCESS_TOKEN_EXPIRE_MINUTES", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^ACCESS_TOKEN_EXPIRE_MINUTES = 12 * 60   # 12 hours$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ALGORITHM", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^ALGORITHM = \"HS256\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DATABASE_PATH", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^DATABASE_PATH = \"tic_tac_toe.db\"  # assumes db placed in working directory$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "GameCreateRequest", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameCreateRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GamePublic", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GamePublic(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MovePublic", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MovePublic(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveRequest", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SECRET_KEY", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^SECRET_KEY = \"CHANGE_THIS_SECRET\"  # Should be overwritten via env in production$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "Token", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class Token(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserPublic", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class UserPublic(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserRegister", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class UserRegister(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_access_token", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):$/", "language": "Python", "kind": "function", "signature": "(data: dict, expires_delta: Optional[timedelta] = None)"}, {"_type": "tag", "name": "get_board_state", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_board_state(game_id: int, current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(game_id: int, current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_current_user(token: str = Depends(oauth2_scheme)):$/", "language": "Python", "kind": "function", "signature": "(token: str = Depends(oauth2_scheme))"}, {"_type": "tag", "name": "get_db", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_game_status", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_game_status(board: str):$/", "language": "Python", "kind": "function", "signature": "(board: str)"}, {"_type": "tag", "name": "get_leaderboard", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_leaderboard():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_moves", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_moves(game_id: int, current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(game_id: int, current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "get_my_games", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_my_games(current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "get_password_hash", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_password_hash(password):$/", "language": "Python", "kind": "function", "signature": "(password)"}, {"_type": "tag", "name": "get_user_by_id", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_user_by_id(db_conn, user_id: int):$/", "language": "Python", "kind": "function", "signature": "(db_conn, user_id: int)"}, {"_type": "tag", "name": "get_user_by_username", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_user_by_username(db_conn, username: str):$/", "language": "Python", "kind": "function", "signature": "(db_conn, username: str)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "init_db", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def init_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def login(form_data: OAuth2PasswordRequestForm = Depends()):$/", "language": "Python", "kind": "function", "signature": "(form_data: OAuth2PasswordRequestForm = Depends())"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def me(current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "opponent_username", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    opponent_username: str = Field(..., description=\"Username of the opponent to play against.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GameCreateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "parse_board", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def parse_board(board: str):$/", "language": "Python", "kind": "function", "signature": "(board: str)"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    password: str = Field(..., min_length=5, max_length=64, description=\"Password\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "position", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    position: int = Field(..., description=\"The board position (0-8) to make a move.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MoveRequest", "scopeKind": "class"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def register(user: UserRegister):$/", "language": "Python", "kind": "function", "signature": "(user: UserRegister)"}, {"_type": "tag", "name": "start_game", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def start_game(req: GameCreateRequest, current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(req: GameCreateRequest, current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "stringify_board", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def stringify_board(matrix):$/", "language": "Python", "kind": "function", "signature": "(matrix)"}, {"_type": "tag", "name": "submit_move", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def submit_move(game_id: int, move: MoveRequest, current_user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(game_id: int, move: MoveRequest, current_user=Depends(get_current_user))"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., min_length=3, max_length=32, description=\"Username\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "verify_password", "path": "/home/kavia/workspace/code-generation/online-tic-tac-toe-with-score-tracking-142401-142432/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def verify_password(plain_password, hashed_password):$/", "language": "Python", "kind": "function", "signature": "(plain_password, hashed_password)"}], "hash": "a8a60b4585f6158c6253fe97ce7b2cd2", "format-version": 4, "code-base-name": "tic_tac_toe_backend", "filename": "tic_tac_toe_backend/src/api/main.py", "fields": [{"name": "ACCESS_TOKEN_EXPIRE_MINUTES = 12 * 60   # 12 hours", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ALGORITHM = \"HS256\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DATABASE_PATH = \"tic_tac_toe.db\"  # assumes db placed in working directory", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SECRET_KEY = \"CHANGE_THIS_SECRET\"  # Should be overwritten via env in production", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str opponent_username", "scope": "GameCreateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str password", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}, {"name": "int position", "scope": "MoveRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str username", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}]}